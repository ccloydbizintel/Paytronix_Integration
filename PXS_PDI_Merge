CREATE OR REPLACE PROCEDURE SALE_PROFIT.PDI.PXS_PROMO_MERGE_PROCEDURE("BEGIN_DATE" DATE, "END_DATE" DATE)
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN

    MERGE INTO paytronix_promotions AS dest
    USING paytronix_promotions_temp AS src
    ON dest.STORE_NUMBER = src.STORE_NUMBER
       AND dest.MARKETBASKET_HEADER_KEY = src.MARKETBASKET_HEADER_KEY
       AND dest.BUSINESS_DATE_PDI = src.BUSINESS_DATE_PDI
       AND dest.TRANSACTION_LINE_ITEM = src.TRANSACTION_LINE_ITEM
       AND dest.CHECK_KEY = src.CHECK_KEY
       AND dest.ITEM_CODE = src.ITEM_CODE
       AND dest.PRODUCT_ID = src.PRODUCT_ID
    WHEN MATCHED THEN
    UPDATE SET
    dest.CHECK_NUMBER = src.CHECK_NUMBER,
    dest.BUSINESS_DATE = src.BUSINESS_DATE,
    dest.FULL_PRICE = src.FULL_PRICE,
    dest.PRICE = src.PRICE,
    dest.UPC = src.UPC,
    dest.ORDINAL = src.ORDINAL,
    dest.QUANTITY = src.QUANTITY,
    dest.REFERENCE_LINE = src.REFERENCE_LINE,
    dest.PRINTED_CARD_NUMBER = src.PRINTED_CARD_NUMBER,
    dest.LABEL = src.LABEL,
    dest.REWARD_ID = src.REWARD_ID,
    dest.BOGO_INDICATOR = src.BOGO_INDICATOR,
    dest.OPEN_DATE_TIME = src.OPEN_DATE_TIME,
    dest.OPEN_DATE = src.OPEN_DATE,
    dest.OPEN_TIME = src.OPEN_TIME,
    dest.OPEN_HOUR = src.OPEN_HOUR,
    dest.CLOSE_DATE_TIME = src.CLOSE_DATE_TIME,
    dest.CLOSE_DATE = src.CLOSE_DATE,
    dest.CLOSE_TIME = src.CLOSE_TIME,
    dest.CLOSE_HOUR = src.CLOSE_HOUR,
    dest.SHELF_DISCOUNT = src.SHELF_DISCOUNT,
    dest.TIME_OF_DAY = src.TIME_OF_DAY,
    dest.DEPARTMENT = src.DEPARTMENT,
    dest.CATEGORY = src.CATEGORY,
    dest.ITEM_NAME = src.ITEM_NAME,
    dest.UPC_PDI = src.UPC_PDI,
    dest.RADIANT_TRANSACTION_NUMBER = src.RADIANT_TRANSACTION_NUMBER,
    dest.STANDARD_DISCOUNT = src.STANDARD_DISCOUNT
    WHEN NOT MATCHED THEN
        INSERT
        (CHECK_KEY, CHECK_NUMBER, STORE_NUMBER, BUSINESS_DATE, FULL_PRICE, PRICE, UPC, ORDINAL, QUANTITY, REFERENCE_LINE, PRINTED_CARD_NUMBER, LABEL, ITEM_CODE, PRODUCT_ID, REWARD_ID, BOGO_INDICATOR, OPEN_DATE_TIME, OPEN_DATE, OPEN_TIME, OPEN_HOUR, CLOSE_DATE_TIME, CLOSE_DATE, CLOSE_TIME, CLOSE_HOUR, SHELF_DISCOUNT, MARKETBASKET_HEADER_KEY, TRANSACTION_LINE_ITEM, BUSINESS_DATE_PDI, TIME_OF_DAY, DEPARTMENT, CATEGORY, ITEM_NAME, UPC_PDI, RADIANT_TRANSACTION_NUMBER, STANDARD_DISCOUNT)
        VALUES (src.CHECK_KEY, src.CHECK_NUMBER, src.STORE_NUMBER, src.BUSINESS_DATE, src.FULL_PRICE, src.PRICE, src.UPC, src.ORDINAL, src.QUANTITY, src.REFERENCE_LINE, src.PRINTED_CARD_NUMBER, src.LABEL, src.ITEM_CODE, src.PRODUCT_ID, src.REWARD_ID, src.BOGO_INDICATOR, src.OPEN_DATE_TIME, src.OPEN_DATE, src.OPEN_TIME, src.OPEN_HOUR, src.CLOSE_DATE_TIME, src.CLOSE_DATE, src.CLOSE_TIME, src.CLOSE_HOUR, src.SHELF_DISCOUNT, src.MARKETBASKET_HEADER_KEY, src.TRANSACTION_LINE_ITEM, src.BUSINESS_DATE_PDI, src.TIME_OF_DAY, src.DEPARTMENT, src.CATEGORY, src.ITEM_NAME, src.UPC_PDI, src.RADIANT_TRANSACTION_NUMBER, src.STANDARD_DISCOUNT);

    RETURN ''Procedure executed successfully'';
END;
';
